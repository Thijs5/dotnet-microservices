# dotnet-microservices
Trying to setup multiple connected microservices. All commands noted below are executed in the root project directory.

## Overview

![Services overview](./assets/readme/services.png "Services overview")

| Service | URL |
| ------- | --- |
| [Users API](#users-api) | [https://localhost:5001/swagger/index.html](https://localhost:5001/swagger/index.html) <br/> [http://localhost:50010/swagger/index.html](http://localhost:50010/swagger/index.html) |

<a id="#users-api"></a>
## Users API
Let's create the first API. The first microservice is all about users. Paste the commands below in the command line to create the project.

```shell
dotnet new webapi -o ./src/Users.Api
```

### Running the Application
After adding some controllers and Swagger configuration ([commit 313ec11](https://github.com/Thijs5/dotnet-microservices/commit/313ec11b3bf834e50ee32134ea2eca0b53421136)), the Users API is live on port 5001 (https) and 50010 (http). Running the API is as simple as running the command below.
```shell
dotnet run --project ./src/Users.Api/Users.Api.csproj
```
Using the command line to run the application is an insult to our IDE since it has a button for it. By adding a `launch.json` and a `tasks.json` (both generated by Visual Studio Code), we can run the users api by the press of a button ([commit 201bfd1](https://github.com/Thijs5/dotnet-microservices/commit/201bfd18bfd7a145e4fbd1abdb2a6443c19b909c)).

### Communicating with a database
The Users Api will store user data. We'll be using a combination of [Entity Framework](https://docs.microsoft.com/en-us/aspnet/entity-framework) and [SQL Server](https://www.microsoft.com/nl-nl/sql-server/sql-server-2019). We start by installing the necessary Nuget packages to the solution. Using the [Nuget Package Manager extension](https://marketplace.visualstudio.com/items?itemName=jmrog.vscode-nuget-package-manager), installing packages is a breeze. We need the following packages:
- `Microsoft.EntityFrameworkCore`
- `Microsoft.EntityFrameworkCore.Design`

After configuring EF and setting up the CRUD actions in the controllers, we still need to create the database and migrations. Open a terminal window and paste the commands below.
```shell
dotnet tool install --global dotnet-ef
dotnet ef migrations add CreateUsersDB --project ./src/Users.Api/Users.Api.csproj 
```
The first commands installs the EF tools needed to run migrations. If they are already installed, you can skip this command. The second one will migrate the database to a version that corresponds with how it is configured in the code. After running the `dotnet ef migrations`-command, notice there is a Migrations-folder added to the project.

After verifying the migration looks good, It is time to actually update the database scheme. Running all migrations can be done using the command below.
```shell
dotnet ef database update --project ./src/Users.Api/Users.Api.csproj
```
